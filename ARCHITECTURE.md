# Architecture

```
                                                     ┌─────────────────┐
                                                     │  bin/kak-spec   │
                                                     └─────────────────┘
                                                       │
                                                       │ executes
                                                       ▼
                                                     ┌─────────────────┐
                                                     │  lib/runner.sh  │ ─┐
                                                     └─────────────────┘  │
                                                       │                  │
                                                       │ launches one     │
                                                       │ per spec file    │
                                                       ▼                  │
┌──────────────────────────────┐                     ┌─────────────────┐  │
│                              │                     │  kak client #1  │  │
│ lib/kak-spec.kak-no-autoload │                     │       ...       │  │
│                              │  ┌────────────────▶ │  kak client #n  │ ─┼────────────────┐
└──────────────────────────────┘  │                  └─────────────────┘  │                │
  ▲                               │                    │                  │                │
  │                               │ eventually         │ each informs     │                │
  │ each loads                    │ commands each to   │ via a separate   │ launches and   │
  │                               │ quit via kak -p    │ FIFO             │ waits for      │
  │                               │                    ▼                  │                │
  │                               │                  ┌─────────────────┐  │                │
  │                               └───────────────── │ lib/reporter.rb │ ◀┘                │
  │                                                  └─────────────────┘                   │
  │                                                    │                                   │
  │                                                    │ prints to                         │
  │                                                    ▼                                   │
  │                                                  ┌─────────────────┐                   │
  │                                                  │   /dev/stdout   │                   │
  │                                                  └─────────────────┘                   │
  │                                                                                        │
  └────────────────────────────────────────────────────────────────────────────────────────┘
```

## Directory Organization

```
.
├── bin                      -- executables
├── doc                      -- `make doc` will populate this with source code documentation
├── example                  -- a collection of specs, many of which fail for illustration
├── lib                      -- **the heavy lifting happens here**
├── man                      -- man page source
├── rc                       -- optional kakoune configuration and documentation
├── script                   -- helper scripts for development
├── share
│   ├── kak-spec
│   │   └── lib -> ../../lib -- a symbolic link trick to help bin/kak-spec find what it needs
│   └── man
│       └── man1             -- manual pages generated by the makefile
└── spec                     -- a collection of specs that should generally pass
```
